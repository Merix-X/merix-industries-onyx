<!doctype html>
<html lang="en">
    <head>
        <!-- Recommended meta tags -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- This script tag bootstraps PyScript -->
        <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

        <title>AI Assistant</title>
    </head>
    <body>
        <!-- User Input for AI query -->
        <section>
            <h2>Ask your question:</h2>
            <input id="user-input" type="text" placeholder="Ask something...">
            <button onclick="send_query()">Ask AI</button>
        </section>

        <section class="pyscript">
            <h2>AI Response:</h2>
            <textarea id="console-output" rows="10" cols="50" readonly></textarea>
        </section>

        <section class="pyscript">
            Hello world! <br />
            Thsit is a answer from AI named Onyx 
            <script type="py">
                import js
                import asyncio
                import json
                from pyodide.http import pyfetch
        
                async def send_query():
                    user_input = js.document.getElementById("user-input").value
                    if not user_input:
                        return
        
                    url = "https://3d0a5f19-94d1-40ec-aab7-b49270c51f9c-00-1gpbht1g7g7d7.spock.replit.dev/ask"  # ZMĚŇTE na skutečný server
                    headers = {"Content-Type": "application/json"}
                    data = json.dumps({"query": user_input})
        
                    response = await pyfetch(url, method="POST", headers=headers, body=data)
                    result = await response.json()
                    
                    output_area = js.document.getElementById("console-output")
                    output_area.value += f"\nYou: {user_input}\nAI: {result['response']}\n"
                    js.document.getElementById("user-input").value = ""
        
                js.document.getElementById("send-button").addEventListener("click", lambda event: asyncio.ensure_future(send_query()))
            </script>
        </section>
    </body>
</html>
