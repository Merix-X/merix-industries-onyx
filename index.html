<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <title>AI Assistant</title>
</head>
<body>
    <!-- User Input for AI query -->
    <section>
        <h2>Ask your question:</h2>
        <input id="user-input" type="text" placeholder="Ask something...">
        <button id="send-button">Ask AI</button>
    </section>

    <section class="pyscript">
        <h2>AI Response:</h2>
        <textarea id="console-output" rows="10" cols="50" readonly></textarea>

        <script type="py">
            import js
            import asyncio
            import json
            from pyodide.http import pyfetch

            # Function to send user input to server and get response
            async def send_query():
                user_input = js.document.getElementById("user-input").value
                if not user_input:
                    return
                
                url = "https://3d0a5f19-94d1-40ec-aab7-b49270c51f9c-00-1gpbht1g7g7d7.spock.replit.dev/ask"  # Replace with your Replit server URL
                headers = {"Content-Type": "application/json"}
                data = json.dumps({"query": user_input})

                # Send request to Flask backend
                response = await pyfetch(url, method="POST", headers=headers, body=data)
                result = await response.json()

                # Display the AI response in the console
                output_area = js.document.getElementById("console-output")
                output_area.value += f"\nYou: {user_input}\nAI: {result['response']}\n"
                js.document.getElementById("user-input").value = ""

            # Attach event listener to button
            js.document.getElementById("send-button").addEventListener("click", lambda event: asyncio.ensure_future(send_query()))
        </script>
    </section>
</body>
</html>
